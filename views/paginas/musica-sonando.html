<!--

    En esta pagina, van a estar los componentes:
        header, menu, aside, reproductor, tabla, footer

-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Musica Sonando</title>

    <!-- Estilos -->

    <link rel="stylesheet" href="../../style/normalize.css" />
    <link rel="stylesheet" href="../../style/general.css" />
    <!--<link rel="stylesheet" href="../../style/index.css">-->

    <link rel="stylesheet" href="../../style/componentes/header.css" />
    <link rel="stylesheet" href="../../style/componentes/menu.css" />
    <link rel="stylesheet" href="../../style/componentes/aside.css" />
    <link rel="stylesheet" href="../../style/componentes/reproductor.css" />
    <link rel="stylesheet" href="../../style/componentes/tabla-2.css" />
    <link rel="stylesheet" href="../../style/componentes/footer.css" />

    <!-- Font Awesome Icons -->
    <script
      src="https://kit.fontawesome.com/ed2ba7d635.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body class="body">
    <!-- Componente HEADER -->
    <header class="header">
      <a href="#" class="header-menu-mobile">
        <i class="fa-solid fa-bars"></i>
      </a>
      <div class="header-titulo">
        <a href="#">
          <h2 class="header-encabezado"></h2>
        </a>
      </div>
      <div class="header-avatar d-none" data-header-avatar>
        <a class="header-cerrar-mobile">
          <i
            class="fa-solid fa-right-from-bracket"
            data-cerrar-sesion-mobile
          ></i>
        </a>
        <div class="header-texto">
          <p class="header-usuario" data-nombre-usuario></p>
          <a class="header-cerrar" data-cerrar-sesion>Cerrar Sesion</a>
        </div>
        <a href="perfil.html" class="header-perfil">
          <i class="fa-solid fa-user"></i>
        </a>
      </div>
    </header>
    <!-- Componente HEADER -->

    <section class="barra-lateral">
      <!-- Componente MENU -->
      <nav class="menu">
        <ul class="menu-lista">
          <li class="menu-item">
            <a href="inicio.html" class="menu-link">
              <div class="menu-icono">
                <i class="fa-solid fa-house"></i>
              </div>
              <div class="menu-texto">
                <span>Home</span>
              </div>
            </a>
          </li>
          <li class="menu-item">
            <a href="buscar.html" class="menu-link">
              <div class="menu-icono">
                <i class="fa-solid fa-magnifying-glass"></i>
              </div>
              <div class="menu-texto">
                <span>Buscar</span>
              </div>
            </a>
          </li>
          <li class="menu-item">
            <a href="mis-albums.html" class="menu-link">
              <div class="menu-icono">
                <i class="fa-solid fa-compact-disc"></i>
              </div>
              <div class="menu-texto">
                <span>Albums</span>
              </div>
            </a>
          </li>
          <li class="menu-item">
            <a href="canciones-favoritas.html" class="menu-link">
              <div class="menu-icono">
                <i class="fa-solid fa-heart"></i>
              </div>
              <div class="menu-texto">
                <span>Favoritos</span>
              </div>
            </a>
          </li>
        </ul>
      </nav>
      <!-- Componente MENU -->

      <!-- Componente ASIDE -->
      <aside class="aside">
        <div class="aside-foto">
          <div class="aside-foto-div">
            <img src="../../assets/img/album.jpg" alt="Album Cover" />
            <span class="aside-estrella">
              <i class="fa-solid fa-star"></i>
            </span>
          </div>
        </div>
        <div class="aside-texto">
          <p>
            Lorem ipsum dolor sit amet consectetur adipisicing elit. Natus eos
            dolore, iste incidunt vel laboriosam culpa provident quam ex
            cupiditate!
          </p>
        </div>
      </aside>
      <!-- Componente ASIDE -->
    </section>

    <main>
      <!-- Componente REPRODUCTOR -->
      <section class="reproductor">
        <article class="reproductor-botones">
          <a href="#" class="reproductor-pause">
            <i class="fa-solid fa-pause"></i>
          </a>
          <a href="#" class="reproductor-play">
            <i class="fa-solid fa-play"></i>
          </a>
          <a href="#" class="reproductor-stop">
            <i class="fa-solid fa-stop"></i>
          </a>
        </article>
        <article class="reproductor-controles">
          <a href="#" class="reproductor-sonido">
            <i class="fa-solid fa-volume-high"></i>
          </a>
          <div class="reproductor-contador">
            <input type="range" name="" id="" value="25" min="0" max="100" />
          </div>
          <a href="#" class="reproductor-ampliar">
            <i class="fa-solid fa-expand"></i>
          </a>
        </article>
      </section>
      <!-- Componente REPRODUCTOR -->

      <!-- Componente TABLA -->
      <section class="favoritos">
        <table>
          <thead>
            <tr class="favoritos-hfila">
              <th class="favoritos-hplay"></th>
              <th class="favoritos-hcancion">Canci칩n</th>
              <th class="favoritos-halbum">Album</th>
              <th class="favoritos-hduracion">Duraci칩n</th>
              <th class="favoritos-hviews">Views</th>
            </tr>
          </thead>
          <tbody data-tbody></tbody>
        </table>
      </section>
      <!-- Componente TABLA -->
    </main>

    <!-- Componente FOOTER -->
    <footer class="footer">
      <div class="footer-integrante">
        <h3 class="footer-nombre">Brian</h3>
        <h3 class="footer-nombre">Klehr</h3>
        <p class="footer-dni">41.026.580</p>
        <a href="https://github.com/Sur4x" target="_blank" class="footer-icono">
          <i class="fa-brands fa-github"></i>
        </a>
      </div>
      <div class="footer-integrante">
        <h3 class="footer-nombre">Alexander</h3>
        <h3 class="footer-nombre">Funes</h3>
        <p class="footer-dni">34.117.699</p>
        <a
          href="https://github.com/javierfunes2018"
          target="_blank"
          class="footer-icono"
        >
          <i class="fa-brands fa-github"></i>
        </a>
      </div>
      <div class="footer-integrante">
        <h3 class="footer-nombre">Antonella</h3>
        <h3 class="footer-nombre">Politi</h3>
        <p class="footer-dni">31.492.164</p>
        <a
          href="https://github.com/AntonellaPoliti"
          target="_blank"
          class="footer-icono"
        >
          <i class="fa-brands fa-github"></i>
        </a>
      </div>
      <div class="footer-integrante">
        <h3 class="footer-nombre">Nahuel</h3>
        <h3 class="footer-nombre">Esposito</h3>
        <p class="footer-dni">43.862.624</p>
        <a
          href="https://github.com/Nahuel0911"
          target="_blank"
          class="footer-icono"
        >
          <i class="fa-brands fa-github"></i>
        </a>
      </div>
      <div class="footer-integrante">
        <h3 class="footer-nombre">Gustavo</h3>
        <h3 class="footer-nombre">Mi침o</h3>
        <p class="footer-dni">38.126.357</p>
        <a
          href="https://github.com/gus-emma-uni"
          target="_blank"
          class="footer-icono"
        >
          <i class="fa-brands fa-github"></i>
        </a>
      </div>
      <div class="footer-integrante">
        <h3 class="footer-nombre">Camila</h3>
        <h3 class="footer-nombre">Marendazzo</h3>
        <p class="footer-dni">43.054.264</p>
        <a
          href="https://github.com/camilamarendazzo"
          target="_blank"
          class="footer-icono"
        >
          <i class="fa-brands fa-github"></i>
        </a>
      </div>
    </footer>
    <!-- Componente FOOTER -->

    <template id="template-fila">
      <tr class="favoritos-fila">
        <td class="favoritos-play">
          <i class="fa-solid fa-play"></i>
        </td>
        <td class="favoritos-cancion">
          <span data-cancion>Canci칩n 1</span>
          <span>
            <i class="fa-regular fa-star" data-estrella-cancion></i>
          </span>
        </td>
        <td class="favoritos-album">
          <span data-album>Album 1</span>
          <span>
            <i class="fa-regular fa-star" data-estrella-album></i>
          </span>
        </td>
        <td class="favoritos-duracion" data-duracion>2:30</td>
        <td class="favoritos-views">
          <span>
            <i class="fa-solid fa-eye"></i>
          </span>
          <span data-views>12594</span>
        </td>
      </tr>
    </template>

    <script>
      const d = document;

      d.addEventListener("DOMContentLoaded", (e) => {
        const datosDesdeLS = JSON.parse(localStorage.getItem("datos"));
        const $nombreUsuario = d.querySelector(`[data-nombre-usuario]`);
        const $cerrarSesion = d.querySelector(`[data-cerrar-sesion]`);
        const $cerrarSesionMobile = d.querySelector(
          `[data-cerrar-sesion-mobile]`
        );

        const $headerAvatar = d.querySelector(`[data-header-avatar]`);

        datosDesdeLS.usuarios.forEach((e) => {
          if (e.estado) {
            $headerAvatar.classList.remove("d-none");
            $headerAvatar.classList.add("d-flex");
            $nombreUsuario.textContent = e.usuario;
          }
        });

        let albumActual = location.search.split("=").pop();

        const $tbody = d.querySelector(`[data-tbody]`);
        const $template = d.getElementById(`template-fila`).content;
        const $fragment = d.createDocumentFragment();

        datosDesdeLS.catalogo.forEach((e) => {
          if (e.id_album === albumActual) {
            e.canciones.forEach((cancion) => {
              $template.querySelector(`[data-cancion]`).textContent =
                cancion.nombre;
              $template.querySelector(`[data-album]`).textContent = e.album;
              $template.querySelector(`[data-duracion]`).textContent =
                cancion.duracion;
              $template.querySelector(`[data-views]`).textContent =
                cancion.views;
              $template.querySelector(
                `[data-estrella-album]`
              ).dataset.idAlbum = `${e.id_album}`;
              $template.querySelector(
                `[data-estrella-cancion]`
              ).dataset.idCancion = `${cancion.id_cancion}`;

              datosDesdeLS.usuarios.forEach((usu) => {
                if (usu.estado) {
                  //console.log(cancion.id_cancion)
                  usu.favoritos.canciones.includes(cancion.id_cancion)
                    ? ($template.querySelector(
                        `[data-estrella-cancion]`
                      ).classList.value = `fa-solid fa-star`)
                    : ($template.querySelector(
                        `[data-estrella-cancion]`
                      ).classList.value = `fa-regular fa-star`);

                  usu.favoritos.albums.includes(e.id_album)
                    ? ($template.querySelector(
                      `[data-estrella-album]`
                      ).classList.value = `fa-solid fa-star`)
                    : ($template.querySelector(
                      `[data-estrella-album]`
                      ).classList.value = `fa-regular fa-star`);
                }
              });

              let $clone = d.importNode($template, true);
              $fragment.appendChild($clone);
            });

            $tbody.appendChild($fragment);
          }
        });

        d.addEventListener("click", (e) => {
          if (e.target == $cerrarSesion) {
            e.preventDefault();

            datosDesdeLS.usuarios.forEach((e) => {
              if (e.estado) {
                e.estado = false;
              }
            });

            localStorage.setItem("datos", JSON.stringify(datosDesdeLS));
            location.href = "../../index.html";
          }
        });

        //configurar estrellas album

        const estrellasAlbum = d.querySelectorAll(`[data-estrella-album]`);

        estrellasAlbum.forEach((el) => {
          el.addEventListener("click", (e) => {
            e.preventDefault();

            datosDesdeLS.catalogo.forEach((el) => {
              if (e.target.dataset.idAlbum == el.id_album) {
                const $estrellaAlbumFavorito = e.target;

                datosDesdeLS.usuarios.forEach((usuario) => {
                  if (usuario.estado) {
                    if (
                      usuario.favoritos.albums.length == 0 ||
                      !usuario.favoritos.albums.includes(el.id_album)
                    ) {
                      usuario.favoritos.albums.push(el.id_album);
                      $estrellaAlbumFavorito.classList.remove(`fa-regular`);
                      $estrellaAlbumFavorito.classList.add(`fa-solid`);
                    } else {
                      usuario.favoritos.albums =
                        usuario.favoritos.albums.filter(
                          (item) => item != el.id_album
                        );
                      $estrellaAlbumFavorito.classList.remove(`fa-solid`);
                      $estrellaAlbumFavorito.classList.add(`fa-regular`);
                    }

                    localStorage.setItem("datos", JSON.stringify(datosDesdeLS));
                  }
                });
              }
            });
          });
        });

        //configurar estrellas canciones

        const estrellasCancion = d.querySelectorAll(`[data-estrella-cancion]`);
        //console.log(estrellasCancion)

        estrellasCancion.forEach((el) => {
          el.addEventListener("click", (e) => {
            e.preventDefault();

            //console.log(el.dataset.idCancion)
            //console.log(e.target.dataset.idCancion)

            if (e.target.dataset.idCancion == el.dataset.idCancion) {
              const $estrellaCancionFavorito = e.target;

              datosDesdeLS.usuarios.forEach((usuario) => {
                if (usuario.estado) {
                  if (
                    usuario.favoritos.canciones.length == 0 ||
                    !usuario.favoritos.canciones.includes(el.dataset.idCancion)
                  ) {
                    usuario.favoritos.canciones.push(el.dataset.idCancion);
                    $estrellaCancionFavorito.classList.remove(`fa-regular`);
                    $estrellaCancionFavorito.classList.add(`fa-solid`);
                  } else {
                    usuario.favoritos.canciones =
                      usuario.favoritos.canciones.filter(
                        (item) => item != el.dataset.idCancion
                      );
                    $estrellaCancionFavorito.classList.remove(`fa-solid`);
                    $estrellaCancionFavorito.classList.add(`fa-regular`);
                  }

                  localStorage.setItem("datos", JSON.stringify(datosDesdeLS));
                }
              });
            }
          });
        });
      });
    </script>
  </body>
</html>
