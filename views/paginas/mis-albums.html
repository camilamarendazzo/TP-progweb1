<!--

    En esta pagina, van a estar los componentes:
        header, menu, aside, reproductor, grilla, footer

-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mis Albums</title>

    <!-- Estilos -->

    <link rel="stylesheet" href="../../style/normalize.css" />
    <link rel="stylesheet" href="../../style/general.css" />
    <link rel="stylesheet" href="../../style/paginas/mis-albums.css" />
    <!--<link rel="stylesheet" href="../../style/index.css">-->

    <link rel="stylesheet" href="../../style/componentes/header.css" />
    <link rel="stylesheet" href="../../style/componentes/menu.css" />
    <link rel="stylesheet" href="../../style/componentes/aside.css" />
    <link rel="stylesheet" href="../../style/componentes/reproductor.css" />
    <link rel="stylesheet" href="../../style/componentes/grilla.css" />
    <link rel="stylesheet" href="../../style/componentes/footer.css" />

    <!-- Font Awesome Icons -->
    <script
      src="https://kit.fontawesome.com/ed2ba7d635.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body class="body">
    <!-- Componente HEADER -->
    <header class="header">
      <a href="#" class="header-menu-mobile">
        <i class="fa-solid fa-bars"></i>
      </a>
      <div class="header-titulo">
        <a href="#">
          <h2 class="header-encabezado">Albums</h2>
        </a>
      </div>
      <div class="header-avatar" data-header-avatar>
        <a
          href="../../index.html"
          class="header-cerrar-mobile"
          data-cerrar-sesion
        >
          <i class="fa-solid fa-right-from-bracket"></i>
        </a>
        <div class="header-texto">
          <p class="header-usuario" data-nombre-usuario></p>
          <a href="../../index.html" class="header-cerrar" data-cerrar-sesion
            >Cerrar Sesion</a
          >
        </div>
        <a href="perfil.html" class="header-perfil">
          <i class="fa-solid fa-user"></i>
        </a>
      </div>
    </header>
    <!-- Componente HEADER -->

    <section class="barra-lateral">
      <!-- Componente MENU -->
      <nav class="menu">
        <ul class="menu-lista">
          <li class="menu-item">
            <a href="inicio.html" class="menu-link">
              <div class="menu-icono">
                <i class="fa-solid fa-house"></i>
              </div>
              <div class="menu-texto">
                <span>Home</span>
              </div>
            </a>
          </li>
          <li class="menu-item">
            <a href="buscar.html" class="menu-link">
              <div class="menu-icono">
                <i class="fa-solid fa-magnifying-glass"></i>
              </div>
              <div class="menu-texto">
                <span>Buscar</span>
              </div>
            </a>
          </li>
          <li class="menu-item">
            <a href="mis-albums.html" class="menu-link active">
              <div class="menu-icono">
                <i class="fa-solid fa-compact-disc"></i>
              </div>
              <div class="menu-texto">
                <span>Albums</span>
              </div>
            </a>
          </li>
          <li class="menu-item">
            <a href="canciones-favoritas.html" class="menu-link">
              <div class="menu-icono">
                <i class="fa-solid fa-heart"></i>
              </div>
              <div class="menu-texto">
                <span>Favoritos</span>
              </div>
            </a>
          </li>
        </ul>
      </nav>
      <!-- Componente MENU -->

      <!-- Componente ASIDE -->
      <aside class="aside">
        <div class="aside-foto">
          <div class="aside-foto-div">
            <img src="../../assets/img/album.jpg" alt="Album Cover" />
            <span class="aside-estrella">
              <i class="fa-solid fa-star"></i>
            </span>
          </div>
        </div>
        <div class="aside-texto">
          <p>
            Lorem ipsum dolor sit amet consectetur adipisicing elit. Natus eos
            dolore, iste incidunt vel laboriosam culpa provident quam ex
            cupiditate!
          </p>
        </div>
      </aside>
      <!-- Componente ASIDE -->
    </section>

    <main>
      <!-- Componente REPRODUCTOR -->
      <section class="reproductor">
        <article class="reproductor-botones">
          <a href="#" class="reproductor-pause">
            <i class="fa-solid fa-pause"></i>
          </a>
          <a href="#" class="reproductor-play">
            <i class="fa-solid fa-play"></i>
          </a>
          <a href="#" class="reproductor-stop">
            <i class="fa-solid fa-stop"></i>
          </a>
        </article>
        <article class="reproductor-controles">
          <a href="#" class="reproductor-sonido">
            <i class="fa-solid fa-volume-high"></i>
          </a>
          <div class="reproductor-contador">
            <input type="range" name="" id="" value="25" min="0" max="100" />
          </div>
          <a href="#" class="reproductor-ampliar">
            <i class="fa-solid fa-expand"></i>
          </a>
        </article>
      </section>
      <!-- Componente REPRODUCTOR -->

      <h3 class="mensaje-album-vacio d-none" data-mensaje-vacio>
        Todavia no agregaste ningun album a favoritos
      </h3>

      <!-- Componente CUADRICULA -->
      <section class="grilla" data-grilla></section>
      <!-- Componente CUADRICULA -->
    </main>

    <!-- Componente FOOTER -->
    <footer class="footer">
      <div class="footer-integrante">
        <h3 class="footer-nombre">Brian</h3>
        <h3 class="footer-nombre">Klehr</h3>
        <p class="footer-dni">41.026.580</p>
        <a href="https://github.com/Sur4x" target="_blank" class="footer-icono">
          <i class="fa-brands fa-github"></i>
        </a>
      </div>
      <div class="footer-integrante">
        <h3 class="footer-nombre">Alexander</h3>
        <h3 class="footer-nombre">Funes</h3>
        <p class="footer-dni">34.117.699</p>
        <a
          href="https://github.com/javierfunes2018"
          target="_blank"
          class="footer-icono"
        >
          <i class="fa-brands fa-github"></i>
        </a>
      </div>
      <div class="footer-integrante">
        <h3 class="footer-nombre">Antonella</h3>
        <h3 class="footer-nombre">Politi</h3>
        <p class="footer-dni">31.492.164</p>
        <a
          href="https://github.com/AntonellaPoliti"
          target="_blank"
          class="footer-icono"
        >
          <i class="fa-brands fa-github"></i>
        </a>
      </div>
      <div class="footer-integrante">
        <h3 class="footer-nombre">Nahuel</h3>
        <h3 class="footer-nombre">Esposito</h3>
        <p class="footer-dni">43.862.624</p>
        <a
          href="https://github.com/Nahuel0911"
          target="_blank"
          class="footer-icono"
        >
          <i class="fa-brands fa-github"></i>
        </a>
      </div>
      <div class="footer-integrante">
        <h3 class="footer-nombre">Gustavo</h3>
        <h3 class="footer-nombre">Mi√±o</h3>
        <p class="footer-dni">38.126.357</p>
        <a
          href="https://github.com/gus-emma-uni"
          target="_blank"
          class="footer-icono"
        >
          <i class="fa-brands fa-github"></i>
        </a>
      </div>
      <div class="footer-integrante">
        <h3 class="footer-nombre">Camila</h3>
        <h3 class="footer-nombre">Marendazzo</h3>
        <p class="footer-dni">43.054.264</p>
        <a
          href="https://github.com/camilamarendazzo"
          target="_blank"
          class="footer-icono"
        >
          <i class="fa-brands fa-github"></i>
        </a>
      </div>
    </footer>
    <!-- Componente FOOTER -->

    <template id="template-album">
      <article class="grilla-album">
        <a>
          <img alt="Foto del album" />
          <span class="grilla-estrella">
            <i
              class="fa-regular fa-star"
              data-estrella-album
              data-id-album="1"
            ></i>
          </span>
        </a>
      </article>
    </template>

    <!--
    <script>
      const d = document;
      const $nombreUsuario = d.querySelector(`[data-nombre-usuario]`);
      const $cerrarSesion = d.querySelector(`[data-cerrar-sesion]`);

      d.addEventListener("DOMContentLoaded", (e) => {
        const datosDesdeLS = JSON.parse(localStorage.getItem("datos"));

        console.log(datosDesdeLS);

        datosDesdeLS.usuarios.forEach((e) => {
          if (e.estado) {
            $nombreUsuario.textContent = e.usuario;
          }
        });

        d.addEventListener("click", (e) => {
          if (e.target == $cerrarSesion) {
            e.preventDefault();
            console.log("cerraste sesion");
            datosDesdeLS.usuarios.forEach((e) => {
              if (e.estado) {
                e.estado = false;
              }
            });

            localStorage.setItem("datos", JSON.stringify(datosDesdeLS));
            location.href = "../../index.html";
          }
        });
      });
    </script>-->
    <script>
      const d = document;

      d.addEventListener("DOMContentLoaded", (e) => {
        const datosDesdeLS = JSON.parse(localStorage.getItem("datos"));

        const $nombreUsuario = d.querySelector(`[data-nombre-usuario]`);
        const $cerrarSesion = d.querySelector(`[data-cerrar-sesion]`);
        const $cerrarSesionMobile = d.querySelector(
          `[data-cerrar-sesion-mobile]`
        );
        const $mensajeAlbumVacio = d.querySelector(`[data-mensaje-vacio]`);
        const $headerAvatar = d.querySelector(`[data-header-avatar]`);

        datosDesdeLS.usuarios.forEach((e) => {
          if (e.estado) {
            $headerAvatar.classList.remove("d-none");
            $headerAvatar.classList.add("d-flex");
            $nombreUsuario.textContent = e.usuario;
          }
        });

        //dibujar cuadricula

        const $grilla = d.querySelector(`[data-grilla]`);
        const $template = d.getElementById(`template-album`).content;
        const $fragment = d.createDocumentFragment();

        let arrAlbums = [];

        datosDesdeLS.usuarios.forEach((usuario) => {
          if (usuario.estado) {
            arrAlbums = usuario.favoritos.albums;
          }
        });

        console.log(arrAlbums);

        if (arrAlbums.length == 0) {
          $mensajeAlbumVacio.classList.remove(`d-none`);
          $mensajeAlbumVacio.classList.add(`d-block`);
        } else {
          $mensajeAlbumVacio.classList.remove(`d-block`);
          $mensajeAlbumVacio.classList.add(`d-none`);
        }

        arrAlbums.forEach((albumFavorito) => {
          const arrAlbumsFavoritos = datosDesdeLS.catalogo.filter(
            (album) => album.id_album == albumFavorito
          );

          console.log(arrAlbumsFavoritos)

          $template.querySelector(
            "a"
          ).href = `musica-sonando.html?album=${arrAlbumsFavoritos[0].id_album}`;
          $template.querySelector(
            "img"
          ).src = `${arrAlbumsFavoritos[0].imagen}`;
          $template.querySelector(
            "i"
          ).dataset.idAlbum = `${arrAlbumsFavoritos[0].id_album}`;

          datosDesdeLS.usuarios.forEach((usu) => {
            if (usu.estado) {
              usu.favoritos.albums.includes(arrAlbumsFavoritos[0].id_album)
                ? ($template.querySelector(
                    "i"
                  ).classList.value = `fa-solid fa-star`)
                : ($template.querySelector(
                    "i"
                  ).classList.value = `fa-regular fa-star`);
            }
          });

          let $clone = d.importNode($template, true);
          $fragment.appendChild($clone);
        });

        $grilla.appendChild($fragment);

        //dibujar cuadricula

        d.addEventListener("click", (e) => {
          if (e.target == $cerrarSesion || e.target == $cerrarSesionMobile) {
            e.preventDefault();

            datosDesdeLS.usuarios.forEach((e) => {
              if (e.estado) {
                e.estado = false;
              }
            });

            localStorage.setItem("datos", JSON.stringify(datosDesdeLS));
            location.href = "../../index.html";
          }
        });

        const estrellasAlbum = d.querySelectorAll(`[data-estrella-album]`);

        estrellasAlbum.forEach((el) => {
          el.addEventListener("click", (e) => {
            e.preventDefault();

            datosDesdeLS.catalogo.forEach((el) => {
              if (e.target.dataset.idAlbum == el.id_album) {
                const $estrellaAlbumFavorito = e.target;

                datosDesdeLS.usuarios.forEach((usuario) => {
                  if (usuario.estado) {
                    if (
                      usuario.favoritos.albums.length == 0 ||
                      !usuario.favoritos.albums.includes(el.id_album)
                    ) {
                      usuario.favoritos.albums.push(el.id_album);
                      $estrellaAlbumFavorito.classList.remove(`fa-regular`);
                      $estrellaAlbumFavorito.classList.add(`fa-solid`);
                    } else {
                      usuario.favoritos.albums =
                        usuario.favoritos.albums.filter(
                          (item) => item != el.id_album
                        );
                      $estrellaAlbumFavorito.classList.remove(`fa-solid`);
                      $estrellaAlbumFavorito.classList.add(`fa-regular`);
                    }

                    localStorage.setItem("datos", JSON.stringify(datosDesdeLS));
                    location.reload();
                  }
                });
              }
            });
          });
        });
      });
    </script>
  </body>
</html>
